<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Lato:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <title>Reset Password</title>

    <style>
      * {
        box-sizing: border-box;
        font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
      }

      body {
        margin: 0;
        background: #fffcfa;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        overflow: hidden;
      }

      .screen {
        width: 100%;
        max-width: 420px;
        background: #fffcfa;
        padding: 32px 16px;
        border-radius: 16px;
        display: flex;
        justify-content: center;
        flex-direction: column;
        height: 100%;
      }

      .logo-container {
        display: flex;
        flex: 1;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      h1 {
        text-align: center;
        font-size: 32px;
        height: 36px;
        font-family: "Fredoka", sans-serif;
        font-weight: 600;
        margin: 0;
        color: #ffc02e;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .input-wrapper {
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
      }

      .input-label {
        font-size: 12px;
        color: #261001;
        font-weight: 500;
        height: 16px;
        visibility: hidden;
        transition: visibility 0.2s;
      }

      .input-label.visible {
        visibility: visible;
      }

      .custom-input {
        width: 100%;
        padding: 12px 40px 12px 16px;
        border-radius: 16px;
        border: 1px solid #7d7d7d;
        font-family: "Lato", sans-serif;
        font-size: 16px;
        transition: border-color 0.2s, box-shadow 0.2s;
        background: white;
        display: flex;
        align-items: center;
      }

      .input-group {
        position: relative;
        display: flex;
        align-items: center;
      }

      .custom-input:focus {
        border-color: #ff842c;
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 132, 44, 0.2);
      }

      .custom-input.error {
        border-color: #e92405;
      }

      .custom-input.error:focus {
        box-shadow: 0 0 0 2px rgba(255, 59, 48, 0.2);
      }

      .icon-button {
        position: absolute;
        right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        cursor: pointer;
        width: 24px;
        height: 24px;
        color: #7d7d7d;
        transition: color 0.2s;
        padding: 0;
      }

      .icon-button:hover {
        color: #ff842c;
      }

      .error-message {
        font-size: 10px;
        color: #e92405;
        margin-top: 4px;
        height: 12px;
        font-weight: 500;
        padding-left: 12px;
        visibility: hidden;
      }

      .form-layout {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        height: 70%;
      }

      .inputs {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .error-message.show {
        visibility: visible;
      }

      .bottom-section {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 36px;
      }

      .progress-bar {
        display: flex;
        gap: 8px;
      }

      .progress-line {
        flex: 1;
        height: 8px;
        border-radius: 20px;
        background: #ff842c;
      }

      button {
        width: 100%;
        padding: 8px;
        border-radius: 16px;
        border: none;
        background: #ff842c;
        color: #fffcfa;
        font-size: 28px;
        font-weight: 500;
        font-family: "Fredoka", sans-serif;
        cursor: pointer;
        transition: opacity 0.2s;
      }

      button:hover:not(:disabled) {
        opacity: 0.9;
      }

      button:disabled {
        background: #7d7d7d;
        cursor: not-allowed;
      }

      .top-section {
        height: 50%;
        justify-content: space-around;
      }

      .spacer {
        height: 64px;
        flex: 1;
      }
    </style>
  </head>

  <body>
    <div class="screen">
      <div class="top-section">
        <div class="spacer"></div>
        <div class="logo-container">
          <svg
            width="160px"
            height="85px"
            viewBox="0 0 158.62 97.25"
            xmlns="http://www.w3.org/2000/svg"
            aria-label="Tudy logo"
          >
            <defs>
              <style>
                .st0 {
                  fill: #ff8229;
                }
                .st1 {
                  fill: none;
                  stroke: #ff8229;
                  stroke-miterlimit: 10;
                }
              </style>
            </defs>
            <rect
              class="st0"
              x="21.65"
              y="54.75"
              width="23.01"
              height="4.89"
              rx="2.44"
              ry="2.44"
            />
            <rect
              class="st0"
              x="86.83"
              y="63.81"
              width="23.01"
              height="4.89"
              rx="2.44"
              ry="2.44"
              transform="translate(164.59 -32.08) rotate(90)"
            />
            <rect
              class="st0"
              x="118.67"
              y="68.3"
              width="14.02"
              height="4.89"
              rx="2.44"
              ry="2.44"
              transform="translate(196.43 -54.94) rotate(90)"
            />
            <rect
              class="st0"
              x="115.22"
              y="59.28"
              width="14.02"
              height="4.89"
              rx="2.44"
              ry="2.44"
              transform="translate(95.89 -72.65) rotate(52.11)"
            />
            <rect
              class="st0"
              x="121.82"
              y="59.28"
              width="14.02"
              height="4.89"
              rx="2.44"
              ry="2.44"
              transform="translate(256.67 -2.04) rotate(127.89)"
            />
            <rect
              class="st0"
              x="21.65"
              y="63.81"
              width="23.01"
              height="4.89"
              rx="2.44"
              ry="2.44"
              transform="translate(99.4 33.1) rotate(90)"
            />
            <rect
              class="st0"
              x="31.37"
              y="45.63"
              width="51.21"
              height="9.71"
              rx="4.86"
              ry="4.86"
              transform="translate(107.46 -6.49) rotate(90)"
            />
            <rect
              class="st0"
              x="54.13"
              y="45.63"
              width="51.21"
              height="9.71"
              rx="4.86"
              ry="4.86"
              transform="translate(130.22 -29.25) rotate(90)"
            />
            <path
              class="st1"
              d="M100.51,59.9h5.41c.52.16,1.52.54,2.42,1.47,1.36,1.42,1.56,3.13,1.6,3.64v2.71c-.05.64-.26,2.08-1.29,3.47-.71.96-1.53,1.51-2.04,1.81-2.03-.02-4.06-.04-6.09-.05v-13.05Z"
            />
            <path
              class="st0"
              d="M98.34,54.75h9.22c.85.27,3.23,1.14,5.06,3.56,1.68,2.23,1.95,4.51,2.01,5.42v5.73c-.1.94-.48,3.28-2.32,5.42-1.27,1.48-2.69,2.25-3.54,2.62l-10.44.24v-4.76h8.26l2.63-2.76.71-2.51v-2.71l-.66-2.32-.94-1.32-1.85-1.27-2.34-.21h-5.81v-5.15Z"
            />
            <path
              class="st0"
              d="M52.18,71.92c.23.85,1.11,3.62,3.87,5.65,2.39,1.75,4.85,1.95,5.78,1.98h13.04c.75.03,3.57.05,6.19-1.98,2.69-2.09,3.33-4.93,3.47-5.65-3.22-.52-6.44-1.04-9.66-1.57h-22.76l.05,1.57Z"
            />
            <path
              class="st0"
              d="M31.7,38.39h9.12c.55.31,1.96,1.22,2.72,3.01.81,1.9.72,4.42-.78,6.21-1.97,2.34-5.47,2.32-7.76,1.16-2.13-1.07-3.03-3.03-3.3-3.69v-6.69Z"
            />
            <path
              class="st0"
              d="M105.22,38.39h-9.12c-.55.31-1.96,1.22-2.72,3.01-.81,1.9-.72,4.42.78,6.21,1.97,2.34,5.47,2.32,7.76,1.16,2.13-1.07,3.03-3.03,3.3-3.69v-6.69Z"
            />
          </svg>
          <h1>Reset Password</h1>
        </div>
      </div>

      <form
        class="form-layout"
        id="resetForm"
        method="POST"
        action="/api/auth/reset-password"
      >
        <input type="hidden" name="token" value="{{TOKEN}}" />

        <div class="inputs">
          <div class="input-wrapper">
            <label for="password" class="input-label">Password</label>
            <div class="input-group">
              <input
                type="password"
                id="password"
                name="newPassword"
                class="custom-input"
                required
                placeholder="Password"
              />
              <button
                type="button"
                class="icon-button"
                id="togglePassword"
              ></button>
            </div>
            <div class="error-message" id="passwordError"></div>
          </div>

          <div class="input-wrapper">
            <label for="repeatPassword" class="input-label"
              >Repeat Password</label
            >
            <div class="input-group">
              <input
                type="password"
                id="repeatPassword"
                name="repeatPassword"
                class="custom-input"
                required
                placeholder="Repeat Password"
              />
              <button
                type="button"
                class="icon-button"
                id="toggleRepeatPassword"
              ></button>
            </div>
            <div class="error-message" id="repeatPasswordError"></div>
          </div>
        </div>

        <div class="bottom-section">
          <div class="progress-bar">
            <div class="progress-line"></div>
            <div class="progress-line"></div>
          </div>

          <button type="submit" id="submitBtn">Done</button>
        </div>
      </form>
    </div>

    <script>
      const passwordInput = document.getElementById("password");
      const repeatPasswordInput = document.getElementById("repeatPassword");
      const togglePasswordBtn = document.getElementById("togglePassword");
      const toggleRepeatPasswordBtn = document.getElementById(
        "toggleRepeatPassword"
      );
      const passwordLabel = document.querySelector('label[for="password"]');
      const repeatPasswordLabel = document.querySelector(
        'label[for="repeatPassword"]'
      );
      const passwordError = document.getElementById("passwordError");
      const repeatPasswordError = document.getElementById(
        "repeatPasswordError"
      );
      const submitBtn = document.getElementById("submitBtn");

      let passwordVisible = false;
      let repeatPasswordVisible = false;

      const eyeClosedSvg = `
<svg width="24" height="24" viewBox="0 0 24 24" fill="none"
     xmlns="http://www.w3.org/2000/svg">
  <path d="M2.00213 11.9797
    L9.14046 19.1247
    C6.07046 18.3188 4.04296 16.3055 2.80796 14.5488
    C2.26796 13.7805 2.00046 12.8805 2.00213 11.9797
    Z"
    fill="currentColor"/>
  <path d="M2.80796 9.43051
    C2.6663 9.63218 2.54546 9.84384 2.4413 10.0613
    L11.8646 19.4847
    H12.0005
    C13.0371 19.4847 14.033 19.3572 14.9813 19.0947
    L3.9388 8.05301
    C3.5413 8.48134 3.1588 8.93134 2.80796 9.43051
    Z"
    fill="currentColor"/>
  <path d="M21.6338 21.6338
    C21.3896 21.878 21.0696 21.9997 20.7496 21.9997
    C20.4296 21.9997 20.1096 21.878 19.8655 21.6338
    L2.3663 4.13468
    C1.8788 3.64634 1.8788 2.85468 2.3663 2.36634
    C2.85463 1.87884 3.6463 1.87884 4.13463 2.36634
    L7.30463 5.53634
    C8.74296 4.84884 10.3188 4.50051 12.0005 4.50051
    C16.7271 4.50051 19.608 7.18718 21.193 9.44134
    C22.2688 10.9722 22.2688 13.0288 21.193 14.5597
    C20.5038 15.5405 19.7213 16.388 18.858 17.0905
    L21.6346 19.8672
    C22.123 20.3547 22.123 21.1472 21.6346 21.6347
    Z"
    fill="currentColor"/>
  <path d="M9.21796 7.45051
    L10.698 8.93051
    C11.9113 8.41634 13.3671 8.65384 14.3571 9.64301
    C15.3471 10.6322 15.5838 12.088 15.0696 13.3022
    L17.0771 15.3097
    C17.8421 14.723 18.5363 13.9905 19.1471 13.1213
    C19.618 12.4505 19.618 11.5488 19.1471 10.878
    C17.9038 9.10884 15.6538 6.99968 12.0005 6.99968
    C11.0188 6.99968 10.088 7.15134 9.21796 7.45051
    Z"
    fill="currentColor"/>
</svg>
`;

      const eyeOpenSvg = `
<svg width="24" height="24" viewBox="0 0 24 24" fill="none"
     xmlns="http://www.w3.org/2000/svg">
  <path d="M21.199 9.40374
    C19.1753 6.28144 15.7203 4.38246 11.9996 4.34755
    C8.27903 4.38246 4.82402 6.28144 2.80033 9.40374
    C1.73387 10.9688 1.73387 13.0272 2.80033 14.5923
    C4.82288 17.7165 8.27808 19.6175 11.9997 19.6535
    C15.7203 19.6186 19.1753 17.7196 21.199 14.5973
    C22.2677 13.031 22.2677 10.97 21.199 9.40374
    Z
    M19.1282 13.1733
    C17.5832 15.6239 14.8966 17.119 11.9996 17.1405
    C9.10271 17.1191 6.41609 15.6239 4.87102 13.1733
    C4.38935 12.4656 4.38935 11.5354 4.87102 10.8278
    C6.41606 8.37718 9.10267 6.88205 11.9996 6.86057
    C14.8965 6.88201 17.5832 8.37718 19.1282 10.8278
    C19.6099 11.5354 19.6099 12.4656 19.1282 13.1733
    Z"
    fill="currentColor"/>
  <path d="M11.9997 15.3512
    C13.8502 15.3512 15.3503 13.851 15.3503 12.0005
    C15.3503 10.15 13.8502 8.64983 11.9997 8.64983
    C10.1491 8.64983 8.64899 10.15 8.64899 12.0005
    C8.64899 13.851 10.1491 15.3512 11.9997 15.3512
    Z"
    fill="currentColor"/>
</svg>
`;

      togglePasswordBtn.innerHTML = eyeClosedSvg;
      toggleRepeatPasswordBtn.innerHTML = eyeClosedSvg;

      // Toggle password visibility
      togglePasswordBtn.addEventListener("click", () => {
        passwordVisible = !passwordVisible;
        passwordInput.type = passwordVisible ? "text" : "password";
        togglePasswordBtn.innerHTML = passwordVisible
          ? eyeOpenSvg
          : eyeClosedSvg;
      });

      // Toggle repeat password visibility
      toggleRepeatPasswordBtn.addEventListener("click", () => {
        repeatPasswordVisible = !repeatPasswordVisible;
        repeatPasswordInput.type = repeatPasswordVisible ? "text" : "password";
        toggleRepeatPasswordBtn.innerHTML = repeatPasswordVisible
          ? eyeOpenSvg
          : eyeClosedSvg;
      });

      // Handle label visibility for password
      passwordInput.addEventListener("input", () => {
        if (passwordInput.value) {
          passwordLabel.classList.add("visible");
        } else {
          passwordLabel.classList.remove("visible");
        }
        passwordError.classList.remove("show");
        passwordInput.classList.remove("error");
      });

      // Handle label visibility for repeat password
      repeatPasswordInput.addEventListener("input", () => {
        if (repeatPasswordInput.value) {
          repeatPasswordLabel.classList.add("visible");
        } else {
          repeatPasswordLabel.classList.remove("visible");
        }
        repeatPasswordError.classList.remove("show");
        repeatPasswordInput.classList.remove("error");
      });

      // Validation function
      function validatePassword(password) {
        return password.length >= 8;
      }

      // Form submission
      document.getElementById("resetForm").addEventListener("submit", (e) => {
        e.preventDefault();

        const password = passwordInput.value;
        const repeatPassword = repeatPasswordInput.value;
        let hasError = false;

        // Clear previous errors
        passwordError.classList.remove("show");
        repeatPasswordError.classList.remove("show");
        passwordInput.classList.remove("error");
        repeatPasswordInput.classList.remove("error");

        // Validate first password
        if (!password) {
          passwordError.textContent = "Password is required";
          passwordError.classList.add("show");
          passwordInput.classList.add("error");
          hasError = true;
        } else if (!validatePassword(password)) {
          passwordError.textContent =
            "Password must be at least 8 characters long";
          passwordError.classList.add("show");
          passwordInput.classList.add("error");
          hasError = true;
        }

        // Validate repeat password
        if (!repeatPassword) {
          repeatPasswordError.textContent = "Please confirm your password";
          repeatPasswordError.classList.add("show");
          repeatPasswordInput.classList.add("error");
          hasError = true;
        } else if (password !== repeatPassword) {
          repeatPasswordError.textContent = "Passwords do not match";
          repeatPasswordError.classList.add("show");
          repeatPasswordInput.classList.add("error");
          hasError = true;
        }

        // If no errors, submit
        if (!hasError) {
          document.getElementById("resetForm").submit();
        }
      });

      // Enable/disable submit button based on inputs
      function updateSubmitBtn() {
        const hasPassword = passwordInput.value.length > 0;
        const hasRepeatPassword = repeatPasswordInput.value.length > 0;
        submitBtn.disabled = !(hasPassword && hasRepeatPassword);
      }

      passwordInput.addEventListener("input", updateSubmitBtn);
      repeatPasswordInput.addEventListener("input", updateSubmitBtn);

      // Initial state
      updateSubmitBtn();
    </script>
  </body>
</html>
